---
- name: nginx and users
  hosts: all
  gather_facts: yes
  become: yes

  vars:
    server: "{{ inventory_hostname }}"
    domain: "{{ ansible_host }}"

  vars_files:
    - "host_vars/{{ server }}.yml"
    - secrets/common.vault
    - host_vars/common.yml

  tasks:
  
  - name: create content folder
    file:
      path: /var/www/{{ domain }}
      mode: 0755
      state: directory

  - name: copy site content
    copy:
      src: ./host_files/{{ domain }}.html
      dest: /var/www/{{ domain }}/index.nginx-debian.html
      mode: 0755

  roles:
    - role: nginx
      configs: 'host_files/configs/nginx.conf'
      ssl_renewal: True
      ssl:
        - domain1.com
        - domain2.com
      vhosts:
        - uberlegenheit
        - biba.uberlegenheit.ru
